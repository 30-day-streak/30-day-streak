{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './ActiveChallengePreview.css';\nexport default class ActiveChallengePreview extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      challengeDay: 0,\n      activeChallengeDetails: false\n    };\n\n    this.toggleChallengeDetails = () => {\n      this.setState(prevState => ({\n        activeChallengeDetails: !prevState.activeChallengeDetails\n      }));\n    };\n\n    this.selectReward = () => {\n      const rewards = this.props.user.rewards;\n      const chosenRewardIndex = Math.floor(Math.random() * rewards.length);\n      return rewards[chosenRewardIndex];\n    };\n\n    this.notifier = async () => {\n      const today = this.state.challengeDay;\n      const thisProjectsTracker = this.props.challenge.tracker;\n      const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today);\n      const userID = this.props.userId;\n      let changedToggle = \"\";\n      console.log(`notifier called`);\n      console.log({\n        today\n      });\n      console.log(`todays val`, thisProjectsTracker[today - 1]);\n      console.log({\n        streakStatusData\n      }); //7-day streak\n\n      if (thisProjectsTracker[today - 1] === 1 && streakStatusData.currentStreak === 7 // && this.props.challenge.subGoals7DayStreak === false\n      ) {\n          changedToggle = \"subGoals7DayStreak\";\n          let todaysReward = this.selectReward();\n          await this.props.notifyMilestone([\"7\", todaysReward, this.props.challenge.id, changedToggle]);\n          console.log(`7 day streak`);\n          this.props.challenge.subGoals7DayStreak = true;\n          return;\n        } //half-way\n\n\n      if (thisProjectsTracker[today - 1] === 1 && (today === 15 || today === 16 || today === 17) // && this.props.challenge.notification15Days === false\n      ) {\n          changedToggle = \"notification15Days\";\n          await this.props.notifyMilestone([\"15\", {}, this.props.challenge.id, changedToggle]);\n          console.log(`half way`);\n          this.props.challenge.notification15Days = true;\n          return;\n        } //21-day streak\n\n\n      if (thisProjectsTracker[today - 1] === 1 && streakStatusData.currentStreak === 21 && this.props.challenge.subGoals21DayStreak === false) {\n        let todaysReward = this.selectReward();\n        changedToggle = \"subGoals21DayStreak\";\n        await this.props.notifyMilestone([\"21\", todaysReward, this.props.challenge.id, changedToggle]);\n        console.log(`21-day streak`);\n        this.props.challenge.subGoals21DayStreak = true;\n        return;\n      } //nearly there\n\n\n      if (thisProjectsTracker[today - 1] === 1 && today === 28 && this.props.challenge.notification28Days === false) {\n        changedToggle = \"notification28Days\";\n        await this.props.notifyMilestone([\"28\", {}, this.props.challenge.id, changedToggle]);\n        console.log(`nearly there`);\n        this.props.challenge.notification28Days = true;\n        return;\n      } //completion\n\n\n      if (today >= 30 && this.props.challenge.notificationComplete === false) {\n        if (streakStatusData.daysCompleted === 30) {\n          changedToggle = \"notificationCompleted\";\n          await this.props.notifyMilestone([\"success\", {}, this.props.challenge.id, changedToggle]);\n          console.log(`notify complete`); //main goal\n        } else {\n          console.log(`notify near complete`);\n          changedToggle = \"notificationCompleted\";\n          await this.props.notifyMilestone([\"notQuite\", {}, this.props.challenge.id, changedToggle]);\n        }\n\n        this.props.challenge.notificationComplete = true;\n        return;\n      }\n\n      ;\n    };\n\n    this.withdrawFromChallenge = () => {\n      axios.put(`/users/${this.props.challenge.id._id}/withdraw`).then(user => {\n        console.log('user', user.data);\n        this.props.setUser(user.data);\n        console.log('test');\n        this.props.history.push('/');\n      });\n    };\n\n    this.handleChange = async event => {\n      console.log(this.props.user);\n\n      try {\n        const target = event.target;\n        const value = target.checked;\n        const name = target.id; // console.log('target', target, 'value', value, 'name', name);\n\n        let challengeTracker = this.props.challenge.tracker;\n        let index = target.id;\n\n        if (event.target.id < this.state.challengeDay) {\n          if (challengeTracker[index] === 0) {\n            challengeTracker[index]++;\n          } else if (challengeTracker[index] === 1) {\n            challengeTracker[index]++;\n          } else {\n            challengeTracker[index]--;\n            challengeTracker[index]--;\n          }\n\n          this.setState({\n            [name]: value\n          });\n          let userId = this.props.user._id;\n          const updatedUser = await axios.put(`/api/users/${userId}`, {\n            challenges: this.state.user.challenges,\n            rewards: this.state.user.rewards\n          });\n          const refresh = this.props.refreshActiveChallengeDetails();\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay\n    });\n    console.log(`startdate`, this.props.challenge.startDate);\n  }\n\n  render() {\n    const challengeDay = this.state.challengeDay;\n    const todayIndex = challengeDay - 1;\n\n    if (!this.props.challenge.id.title) {\n      window.location.reload(false);\n    } else {\n      // console.log('props from preview ');\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"active-preview\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"preview-title\",\n          children: /*#__PURE__*/_jsxDEV(\"h5\", {\n            children: this.props.challenge.id.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: this.props.challenge.id.goal\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [this.props.challenge.id.dailyTarget.description, this.props.challenge.id.dailyTarget.number, this.props.challenge.id.dailyTarget.unit]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"awesome-button\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Click below to log today: \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TrackerButton, {\n            index: todayIndex,\n            user: this.props.user,\n            handleChange: this.handleChange,\n            challenge: this.props.challenge,\n            challengeDay: this.state.challengeDay\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 11\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(ActiveChallengeDetails, {\n          challenge: this.props.challenge,\n          user: this.props.user,\n          challengeDay: this.state.challengeDay,\n          calculateChallengeDay: this.props.calculateChallengeDay,\n          streakStatus: this.props.streakStatus,\n          notifier: this.notifier\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 13\n        }, this), !this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.toggleChallengeDetails,\n          children: \"show details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 13\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.toggleChallengeDetails,\n          children: \"hide details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 13\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.withdrawFromChallenge,\n          children: \"i give up, i'm a bit fat looser\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this);\n    }\n  }\n\n}","map":{"version":3,"sources":["/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js"],"names":["React","Component","axios","ActiveChallengeDetails","TrackerButton","ActiveChallengePreview","state","challengeDay","activeChallengeDetails","toggleChallengeDetails","setState","prevState","selectReward","rewards","props","user","chosenRewardIndex","Math","floor","random","length","notifier","today","thisProjectsTracker","challenge","tracker","streakStatusData","streakStatus","userID","userId","changedToggle","console","log","currentStreak","todaysReward","notifyMilestone","id","subGoals7DayStreak","notification15Days","subGoals21DayStreak","notification28Days","notificationComplete","daysCompleted","withdrawFromChallenge","put","_id","then","data","setUser","history","push","handleChange","event","target","value","checked","name","challengeTracker","index","updatedUser","challenges","refresh","refreshActiveChallengeDetails","error","componentDidMount","calculateChallengeDay","startDate","render","todayIndex","title","window","location","reload","goal","dailyTarget","description","number","unit"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './ActiveChallengePreview.css';\n\nexport default class ActiveChallengePreview extends Component {\n  state = {\n    challengeDay: 0,\n    activeChallengeDetails: false,\n  };\n\n  toggleChallengeDetails = () => {\n    this.setState((prevState) => ({\n      activeChallengeDetails: !prevState.activeChallengeDetails,\n    }));\n  };\n\n\n\n  selectReward = () => {\n    const rewards = this.props.user.rewards\n    const chosenRewardIndex = Math.floor(Math.random() * rewards.length)\n    return rewards[chosenRewardIndex];\n  }\n\n  notifier = async() => {\n    const today = this.state.challengeDay;\n    const thisProjectsTracker = this.props.challenge.tracker;\n    const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today);\n    const userID = this.props.userId;\n    let changedToggle = \"\";\n    console.log(`notifier called`);\n    console.log({ today });\n    console.log(`todays val`, thisProjectsTracker[today - 1]);\n\n    console.log({ streakStatusData });\n\n\n\n    //7-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 7\n      // && this.props.challenge.subGoals7DayStreak === false\n    ) {\n      changedToggle = \"subGoals7DayStreak\";\n      let todaysReward = this.selectReward();\n      await this.props.notifyMilestone([\"7\", todaysReward, this.props.challenge.id, changedToggle]);\n      console.log(`7 day streak`);\n      this.props.challenge.subGoals7DayStreak = true;\n      return    }\n\n    //half-way\n    if (thisProjectsTracker[today - 1] === 1 &&\n      (today === 15 || today === 16 || today === 17)\n      // && this.props.challenge.notification15Days === false\n    ) {\n      changedToggle = \"notification15Days\";\n      await this.props.notifyMilestone([\"15\", {}, this.props.challenge.id, changedToggle]);\n      console.log(`half way`);\n      this.props.challenge.notification15Days = true;\n      return\n    }\n\n    //21-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 21\n      && this.props.challenge.subGoals21DayStreak === false\n    ) {\n      let todaysReward = this.selectReward();\n      changedToggle = \"subGoals21DayStreak\";\n      await this.props.notifyMilestone([\"21\", todaysReward, this.props.challenge.id, changedToggle]);\n      console.log(`21-day streak`);\n      this.props.challenge.subGoals21DayStreak = true;\n      return\n    }\n\n    //nearly there\n    if (thisProjectsTracker[today - 1] === 1 &&\n      today === 28\n      && this.props.challenge.notification28Days === false\n    ) {\n      changedToggle = \"notification28Days\";\n      await this.props.notifyMilestone([\"28\", {}, this.props.challenge.id, changedToggle]);\n      console.log(`nearly there`);\n      this.props.challenge.notification28Days = true;\n      return\n    }\n\n    //completion\n    if (today >= 30\n      && this.props.challenge.notificationComplete === false\n    ) {\n      if (streakStatusData.daysCompleted === 30) {\n        changedToggle = \"notificationCompleted\"\n        await this.props.notifyMilestone([\"success\", {}, this.props.challenge.id, changedToggle]);\n        console.log(`notify complete`);\n        //main goal\n      } else {\n        console.log(`notify near complete`);\n        changedToggle = \"notificationCompleted\"\n        await this.props.notifyMilestone([\"notQuite\", {}, this.props.challenge.id, changedToggle]);\n      }\n      this.props.challenge.notificationComplete = true;\n      return\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay,\n    })\n    console.log(`startdate`, this.props.challenge.startDate);\n\n  }\n\n  withdrawFromChallenge = () => {\n    axios.put(`/users/${this.props.challenge.id._id}/withdraw`)\n      .then((user) => {\n        console.log('user', user.data)\n        this.props.setUser(user.data)\n        console.log('test')\n        this.props.history.push('/')\n      })\n  }\n\n  handleChange = async (event) => {\n    console.log(this.props.user);\n\n    try {\n      const target = event.target;\n      const value = target.checked;\n      const name = target.id;\n      // console.log('target', target, 'value', value, 'name', name);\n      let challengeTracker = this.props.challenge.tracker;\n      let index = target.id;\n      if (event.target.id < this.state.challengeDay) {\n        if (challengeTracker[index] === 0) {\n          challengeTracker[index]++;\n        } else if (challengeTracker[index] === 1) {\n          challengeTracker[index]++;\n        } else {\n          challengeTracker[index]--;\n          challengeTracker[index]--;\n\n        }\n        this.setState({\n          [name]: value,\n        });\n        let userId = this.props.user._id;\n        const updatedUser = await axios.put(`/api/users/${userId}`, {\n          challenges: this.state.user.challenges,\n          rewards: this.state.user.rewards,\n        });\n        const refresh = this.props.refreshActiveChallengeDetails()\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  render() {\n    const challengeDay = this.state.challengeDay\n    const todayIndex = challengeDay - 1\n    if (!this.props.challenge.id.title) {\n      window.location.reload(false);\n    } else {\n      // console.log('props from preview ');\n      return (\n        <div className=\"active-preview\">\n          <div className=\"preview-title\">\n            <h5>{this.props.challenge.id.title}</h5>\n          </div>\n          <p>{this.props.challenge.id.goal}</p>\n          <p>\n            {this.props.challenge.id.dailyTarget.description}\n            {this.props.challenge.id.dailyTarget.number}\n            {this.props.challenge.id.dailyTarget.unit}\n          </p>\n\n          <div className=\"awesome-button\">\n            <p>Click below to log today: </p>\n            <TrackerButton\n              index={todayIndex}\n              user={this.props.user}\n              handleChange={this.handleChange}\n              challenge={this.props.challenge}\n              challengeDay={this.state.challengeDay}\n            />\n          </div>\n          {this.state.activeChallengeDetails && (\n            <ActiveChallengeDetails\n              challenge={this.props.challenge}\n              user={this.props.user}\n              challengeDay={this.state.challengeDay}\n              calculateChallengeDay={this.props.calculateChallengeDay}\n              streakStatus={this.props.streakStatus}\n              notifier={this.notifier}\n            />\n          )}\n          {!this.state.activeChallengeDetails && (\n            <button\n              className=\"button-light\"\n              onClick={this.toggleChallengeDetails}\n            >\n              show details\n            </button>\n          )}\n          {this.state.activeChallengeDetails && (\n            <button\n              className=\"button-light\"\n              onClick={this.toggleChallengeDetails}\n            >\n              hide details\n            </button>\n          )}\n          {this.state.activeChallengeDetails &&\n            <button\n              className=\"button-light\"\n              onClick={this.withdrawFromChallenge}\n            >\n              i give up, i'm a bit fat looser\n            </button>\n          }\n        </div>\n      );\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}