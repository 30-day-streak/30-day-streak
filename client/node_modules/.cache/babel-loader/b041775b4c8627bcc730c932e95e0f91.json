{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './ActiveChallengePreview.css';\nexport default class ActiveChallengePreview extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      challengeDay: 0,\n      activeChallengeDetails: false\n    };\n\n    this.toggleChallengeDetails = () => {\n      this.setState(prevState => ({\n        activeChallengeDetails: !prevState.activeChallengeDetails\n      }));\n    };\n\n    this.selectReward = () => {\n      const rewards = this.props.user.rewards;\n      const chosenRewardIndex = Math.floor(Math.random() * rewards.length);\n      return rewards[chosenRewardIndex];\n    };\n\n    this.notifier = () => {\n      const today = this.state.challengeDay;\n      const thisProjectsTracker = this.props.challenge.tracker;\n      const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today);\n      const userID = this.props.userId;\n      let changedToggle = \"\";\n      console.log(`notifier called`);\n      console.log({\n        today\n      });\n      console.log(`todays val`, thisProjectsTracker[today - 1]);\n      console.log({\n        streakStatusData\n      }); //7-day streak\n\n      if (thisProjectsTracker[today - 1] === 1 && streakStatusData.currentStreak === 7 // && subGoals7DayStreak === false\n      ) {\n          console.log(`7 day streak`);\n          this.props.challenge.subGoals7DayStreak = true;\n          changedToggle = \"subGoals7DayStreak\";\n          let todaysReward = this.selectReward();\n          this.props.notifyMilestone([\"7\", todaysReward, this.props.challenge.id, changedToggle]); //show notification\n        } //half-way\n\n\n      if (thisProjectsTracker[today - 1] === 1 && today >= (15 || 16 || 17) // && this.props.challenge.notification15Days === false\n      ) {\n          console.log(`half way`);\n          this.props.challenge.notification15Days = true;\n          changedToggle = \"notification15Days\";\n          this.props.notifyMilestone([\"15\", {}, this.props.challenge.id, changedToggle]);\n          return;\n        } //21-day streak\n\n\n      if (thisProjectsTracker[today - 1] === 1 && streakStatusData.currentStreak === 21 // && this.props.challenge.subGoals21DayStreak === false\n      ) {\n          console.log(`21-day streak`);\n          this.props.challenge.subGoals21DayStreak = true;\n          changedToggle = \"subGoals21DayStreak\";\n          let todaysReward = this.selectReward();\n          this.props.notifyMilestone([\"21\", todaysReward, this.props.challenge.id, changedToggle]);\n          return; //select prize\n          //show notification\n        } //nearly there\n\n\n      if (thisProjectsTracker[today - 1] === 1 && today === 28 // && this.props.challenge.notification28Days === false\n      ) {\n          console.log(`nearly there`);\n          this.props.challenge.notification28Days = true;\n          changedToggle = \"notification28Days\";\n          this.props.notifyMilestone([\"28\", {}, this.props.challenge.id, changedToggle]);\n          return; //show notification\n        } //completion\n\n\n      if (today >= 30 // && this.props.challenge.notificationComplete === false\n      ) {\n          this.props.challenge.notificationComplete = true;\n\n          if (streakStatusData.daysCompleted === 30) {\n            changedToggle = \"notificationCompleted\";\n            this.props.notifyMilestone([\"success\", {}, this.props.challenge.id, changedToggle]);\n            console.log(`notify complete`); //main goal\n          } else {\n            console.log(`notify near complete`);\n            this.props.notifyMilestone([\"notQuite\", {}, this.props.challenge.id, changedToggle]);\n          }\n\n          changedToggle = \"notificationCompleted\";\n        }\n\n      ;\n    };\n\n    this.withdrawFromChallenge = () => {\n      axios.put(`/users/${this.props.challenge.id._id}/withdraw`).then(user => {\n        console.log('user', user.data);\n        this.props.setUser(user.data);\n        console.log('test');\n        this.props.history.push('/');\n      });\n    };\n\n    this.handleChange = async event => {\n      console.log(this.props.user);\n\n      try {\n        const target = event.target;\n        const value = target.checked;\n        const name = target.id; // console.log('target', target, 'value', value, 'name', name);\n\n        let challengeTracker = this.props.challenge.tracker;\n        let index = target.id;\n\n        if (event.target.id < this.state.challengeDay) {\n          if (challengeTracker[index] === 0) {\n            challengeTracker[index]++;\n          } else if (challengeTracker[index] === 1) {\n            challengeTracker[index]++;\n          } else {\n            challengeTracker[index]--;\n            challengeTracker[index]--;\n          }\n\n          this.setState({\n            [name]: value\n          });\n          let userId = this.props.user._id;\n          const updatedUser = await axios.put(`/api/users/${userId}`, {\n            challenges: this.state.user.challenges,\n            rewards: this.state.user.rewards\n          });\n          const refresh = this.props.refreshActiveChallengeDetails();\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay\n    });\n    console.log(`startdate`, this.props.challenge.startDate);\n  }\n\n  render() {\n    const challengeDay = this.state.challengeDay;\n    const todayIndex = challengeDay - 1;\n\n    if (!this.props.challenge.id.title) {\n      window.location.reload(false);\n    } else {\n      // console.log('props from preview ');\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"active-preview\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"preview-title\",\n          children: /*#__PURE__*/_jsxDEV(\"h5\", {\n            children: this.props.challenge.id.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: this.props.challenge.id.goal\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [this.props.challenge.id.dailyTarget.description, this.props.challenge.id.dailyTarget.number, this.props.challenge.id.dailyTarget.unit]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"awesome-button\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Click below to log today: \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TrackerButton, {\n            index: todayIndex,\n            user: this.props.user,\n            handleChange: this.handleChange,\n            challenge: this.props.challenge,\n            challengeDay: this.state.challengeDay\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 11\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(ActiveChallengeDetails, {\n          challenge: this.props.challenge,\n          user: this.props.user,\n          challengeDay: this.state.challengeDay,\n          calculateChallengeDay: this.props.calculateChallengeDay,\n          streakStatus: this.props.streakStatus,\n          notifier: this.notifier\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 13\n        }, this), !this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.toggleChallengeDetails,\n          children: \"show details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 13\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.toggleChallengeDetails,\n          children: \"hide details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 13\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.withdrawFromChallenge,\n          children: \"i give up, i'm a bit fat looser\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 9\n      }, this);\n    }\n  }\n\n}","map":{"version":3,"sources":["/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js"],"names":["React","Component","axios","ActiveChallengeDetails","TrackerButton","ActiveChallengePreview","state","challengeDay","activeChallengeDetails","toggleChallengeDetails","setState","prevState","selectReward","rewards","props","user","chosenRewardIndex","Math","floor","random","length","notifier","today","thisProjectsTracker","challenge","tracker","streakStatusData","streakStatus","userID","userId","changedToggle","console","log","currentStreak","subGoals7DayStreak","todaysReward","notifyMilestone","id","notification15Days","subGoals21DayStreak","notification28Days","notificationComplete","daysCompleted","withdrawFromChallenge","put","_id","then","data","setUser","history","push","handleChange","event","target","value","checked","name","challengeTracker","index","updatedUser","challenges","refresh","refreshActiveChallengeDetails","error","componentDidMount","calculateChallengeDay","startDate","render","todayIndex","title","window","location","reload","goal","dailyTarget","description","number","unit"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './ActiveChallengePreview.css';\n\nexport default class ActiveChallengePreview extends Component {\n  state = {\n    challengeDay: 0,\n    activeChallengeDetails: false,\n  };\n\n  toggleChallengeDetails = () => {\n    this.setState((prevState) => ({\n      activeChallengeDetails: !prevState.activeChallengeDetails,\n    }));\n  };\n\n\n\n  selectReward = () => {\n    const rewards = this.props.user.rewards\n    const chosenRewardIndex = Math.floor(Math.random() * rewards.length)\n    return rewards[chosenRewardIndex];\n  }\n\n  notifier = () => {\n    const today = this.state.challengeDay;\n    const thisProjectsTracker = this.props.challenge.tracker;\n    const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today);\n    const userID = this.props.userId;\n    let changedToggle = \"\";\n    console.log(`notifier called`);\n    console.log({today});\n    console.log(`todays val`, thisProjectsTracker[today - 1]);\n    \n    console.log({streakStatusData});\n    \n    \n\n    //7-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 7 \n      // && subGoals7DayStreak === false\n      ) {\n      console.log(`7 day streak`);\n      this.props.challenge.subGoals7DayStreak = true;\n      changedToggle = \"subGoals7DayStreak\";\n      let todaysReward = this.selectReward();\n      this.props.notifyMilestone([\"7\", todaysReward, this.props.challenge.id, changedToggle]);\n      //show notification\n    }\n\n    //half-way\n    if (thisProjectsTracker[today - 1] === 1 &&\n      today >= (15 || 16 || 17) \n      // && this.props.challenge.notification15Days === false\n      ) {\n      console.log(`half way`);\n      this.props.challenge.notification15Days = true;\n      changedToggle = \"notification15Days\";\n      this.props.notifyMilestone([\"15\", {}, this.props.challenge.id, changedToggle]);\n      return\n    }\n\n    //21-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 21 \n      // && this.props.challenge.subGoals21DayStreak === false\n      ) {\n      console.log(`21-day streak`);\n      this.props.challenge.subGoals21DayStreak = true;\n      changedToggle = \"subGoals21DayStreak\";\n      let todaysReward = this.selectReward();\n      this.props.notifyMilestone([\"21\", todaysReward, this.props.challenge.id, changedToggle]);\n      return\n      //select prize\n      //show notification\n    }\n\n    //nearly there\n    if (thisProjectsTracker[today - 1] === 1 &&\n      today === 28 \n      // && this.props.challenge.notification28Days === false\n      ) {\n      console.log(`nearly there`);\n      this.props.challenge.notification28Days = true;\n      changedToggle = \"notification28Days\";\n      this.props.notifyMilestone([\"28\", {}, this.props.challenge.id, changedToggle]);\n      return\n      //show notification\n    }\n\n    //completion\n    if (today >= 30 \n      // && this.props.challenge.notificationComplete === false\n      ) {\n      this.props.challenge.notificationComplete = true;\n      if (streakStatusData.daysCompleted === 30) {\n        changedToggle = \"notificationCompleted\"\n        this.props.notifyMilestone([\"success\", {}, this.props.challenge.id, changedToggle]);\n        console.log(`notify complete`);\n        //main goal\n      } else {\n        console.log(`notify near complete`);\n        this.props.notifyMilestone([\"notQuite\", {}, this.props.challenge.id, changedToggle]);\n      }\n      changedToggle = \"notificationCompleted\"\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay,\n    })\n    console.log(`startdate`, this.props.challenge.startDate);\n\n  }\n\n  withdrawFromChallenge = () => {\n    axios.put(`/users/${this.props.challenge.id._id}/withdraw`)\n      .then((user) => {\n        console.log('user', user.data)\n        this.props.setUser(user.data)\n        console.log('test')\n        this.props.history.push('/')\n      })\n  }\n\n  handleChange = async (event) => {\n    console.log(this.props.user);\n\n    try {\n      const target = event.target;\n      const value = target.checked;\n      const name = target.id;\n      // console.log('target', target, 'value', value, 'name', name);\n      let challengeTracker = this.props.challenge.tracker;\n      let index = target.id;\n      if (event.target.id < this.state.challengeDay) {\n        if (challengeTracker[index] === 0) {\n          challengeTracker[index]++;\n        } else if (challengeTracker[index] === 1) {\n          challengeTracker[index]++;\n        } else {\n          challengeTracker[index]--;\n          challengeTracker[index]--;\n\n        }\n        this.setState({\n          [name]: value,\n        });\n        let userId = this.props.user._id;\n        const updatedUser = await axios.put(`/api/users/${userId}`, {\n          challenges: this.state.user.challenges,\n          rewards: this.state.user.rewards,\n        });\n        const refresh = this.props.refreshActiveChallengeDetails()\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  render() {\n    const challengeDay = this.state.challengeDay\n    const todayIndex = challengeDay - 1\n    if (!this.props.challenge.id.title) {\n      window.location.reload(false);\n    } else {\n      // console.log('props from preview ');\n      return (\n        <div className=\"active-preview\">\n          <div className=\"preview-title\">\n            <h5>{this.props.challenge.id.title}</h5>\n          </div>\n          <p>{this.props.challenge.id.goal}</p>\n          <p>\n            {this.props.challenge.id.dailyTarget.description}\n            {this.props.challenge.id.dailyTarget.number}\n            {this.props.challenge.id.dailyTarget.unit}\n          </p>\n\n          <div className=\"awesome-button\">\n            <p>Click below to log today: </p>\n            <TrackerButton\n              index={todayIndex}\n              user={this.props.user}\n              handleChange={this.handleChange}\n              challenge={this.props.challenge}\n              challengeDay={this.state.challengeDay}\n            />\n          </div>\n          {this.state.activeChallengeDetails && (\n            <ActiveChallengeDetails\n              challenge={this.props.challenge}\n              user={this.props.user}\n              challengeDay={this.state.challengeDay}\n              calculateChallengeDay={this.props.calculateChallengeDay}\n              streakStatus={this.props.streakStatus}\n              notifier={this.notifier}\n            />\n          )}\n          {!this.state.activeChallengeDetails && (\n            <button\n              className=\"button-light\"\n              onClick={this.toggleChallengeDetails}\n            >\n              show details\n            </button>\n          )}\n          {this.state.activeChallengeDetails && (\n            <button\n              className=\"button-light\"\n              onClick={this.toggleChallengeDetails}\n            >\n              hide details\n            </button>\n          )}\n          {this.state.activeChallengeDetails &&\n            <button\n              className=\"button-light\"\n              onClick={this.withdrawFromChallenge}\n            >\n              i give up, i'm a bit fat looser\n            </button>\n          }\n        </div>\n      );\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}