{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _defineProperty from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import axios from'axios';import ActiveChallengeDetails from'./ActiveChallengeDetails';import TrackerButton from'./TrackerButton';import'./ActiveChallengePreview.css';var ActiveChallengePreview=/*#__PURE__*/function(_Component){_inherits(ActiveChallengePreview,_Component);var _super=_createSuper(ActiveChallengePreview);function ActiveChallengePreview(){var _this;_classCallCheck(this,ActiveChallengePreview);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={challengeDay:0,activeChallengeDetails:false};_this.toggleChallengeDetails=function(){_this.setState(function(prevState){return{activeChallengeDetails:!prevState.activeChallengeDetails};});};_this.selectReward=function(){var rewards=_this.props.user.rewards;var chosenRewardIndex=Math.floor(Math.random()*rewards.length);return rewards[chosenRewardIndex];};_this.notifier=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var today,thisProjectsTracker,streakStatusData,userID,changedToggle,todaysReward,_todaysReward;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:today=_this.state.challengeDay;thisProjectsTracker=_this.props.challenge.tracker;streakStatusData=_this.props.streakStatus(_this.props.challenge.tracker,today);userID=_this.props.userId;changedToggle=\"\";console.log(\"notifier called\");console.log({today:today});console.log(\"todays val\",thisProjectsTracker[today-1]);console.log({streakStatusData:streakStatusData});//7-day streak\nif(!(thisProjectsTracker[today-1]===1&&streakStatusData.currentStreak===7&&_this.props.challenge.subGoals7DayStreak===false)){_context.next=17;break;}changedToggle=\"subGoals7DayStreak\";todaysReward=_this.selectReward();_context.next=14;return _this.props.notifyMilestone([\"7\",todaysReward,_this.props.challenge.id,changedToggle]);case 14:console.log(\"7 day streak\");_this.props.challenge.subGoals7DayStreak=true;return _context.abrupt(\"return\");case 17:if(!(thisProjectsTracker[today-1]===1&&(today===15||today===16||today===17)&&_this.props.challenge.notification15Days===false)){_context.next=26;break;}console.log(_this.props.challenge.notification15Days);changedToggle=\"notification15Days\";_context.next=22;return _this.props.notifyMilestone([\"15\",{},_this.props.challenge.id,changedToggle]);case 22:console.log(\"half way\");_this.props.challenge.notification15Days=true;console.log(_this.props.challenge.notification15Days);return _context.abrupt(\"return\");case 26:if(!(thisProjectsTracker[today-1]===1&&streakStatusData.currentStreak===21&&_this.props.challenge.subGoals21DayStreak===false)){_context.next=34;break;}_todaysReward=_this.selectReward();changedToggle=\"subGoals21DayStreak\";_context.next=31;return _this.props.notifyMilestone([\"21\",_todaysReward,_this.props.challenge.id,changedToggle]);case 31:console.log(\"21-day streak\");_this.props.challenge.subGoals21DayStreak=true;return _context.abrupt(\"return\");case 34:if(!(thisProjectsTracker[today-1]===1&&today===28&&_this.props.challenge.notification28Days===false)){_context.next=41;break;}changedToggle=\"notification28Days\";_context.next=38;return _this.props.notifyMilestone([\"28\",{},_this.props.challenge.id,changedToggle]);case 38:console.log(\"nearly there\");_this.props.challenge.notification28Days=true;return _context.abrupt(\"return\");case 41:if(!(today>=30&&_this.props.challenge.notificationComplete===false)){_context.next=55;break;}if(!(streakStatusData.daysCompleted===30)){_context.next=49;break;}changedToggle=\"notificationCompleted\";_context.next=46;return _this.props.notifyMilestone([\"success\",{},_this.props.challenge.id,changedToggle]);case 46:console.log(\"notify complete\");//main goal\n_context.next=53;break;case 49:console.log(\"notify near complete\");changedToggle=\"notificationCompleted\";_context.next=53;return _this.props.notifyMilestone([\"notQuite\",{},_this.props.challenge.id,changedToggle]);case 53:_this.props.challenge.notificationComplete=true;return _context.abrupt(\"return\");case 55:;case 56:case\"end\":return _context.stop();}}},_callee);}));_this.withdrawFromChallenge=function(){axios.put(\"/users/\".concat(_this.props.challenge.id._id,\"/withdraw\")).then(function(user){console.log('user',user.data);_this.props.setUser(user.data);console.log('test');_this.props.history.push('/');});};_this.handleChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var target,value,name,challengeTracker,index,userId,updatedUser;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(_this.props.user);_context2.prev=1;target=event.target;value=target.checked;name=target.id;// console.log('target', target, 'value', value, 'name', name);\nchallengeTracker=_this.props.challenge.tracker;index=target.id;if(!(event.target.id<_this.state.challengeDay)){_context2.next=15;break;}if(challengeTracker[index]===0){challengeTracker[index]++;}else if(challengeTracker[index]===1){challengeTracker[index]++;}else{challengeTracker[index]--;challengeTracker[index]--;}_this.setState(_defineProperty({},name,value));userId=_this.props.user._id;_context2.next=13;return axios.put(\"/api/users/\".concat(userId),{challenges:_this.props.user.challenges,rewards:_this.props.user.rewards});case 13:updatedUser=_context2.sent;_this.props.setUser(updatedUser.data);// const refresh = this.props.refreshActiveChallengeDetails()\ncase 15:_context2.next=20;break;case 17:_context2.prev=17;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);case 20:case\"end\":return _context2.stop();}}},_callee2,null,[[1,17]]);}));return function(_x){return _ref2.apply(this,arguments);};}();return _this;}_createClass(ActiveChallengePreview,[{key:\"componentDidMount\",value:function componentDidMount(){var challengeDay=this.props.calculateChallengeDay(this.props.challenge.startDate);this.setState({challengeDay:challengeDay});console.log(\"startdate\",this.props.challenge.startDate);}},{key:\"render\",value:function render(){var challengeDay=this.state.challengeDay;var todayIndex=challengeDay-1;if(!this.props.challenge.id.title){window.location.reload(false);}else{// console.log('props from preview ');\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"active-preview\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"preview-title\",children:/*#__PURE__*/_jsx(\"h5\",{children:this.props.challenge.id.title})}),/*#__PURE__*/_jsx(\"p\",{children:this.props.challenge.id.goal}),/*#__PURE__*/_jsxs(\"p\",{children:[this.props.challenge.id.dailyTarget.description,this.props.challenge.id.dailyTarget.number,this.props.challenge.id.dailyTarget.unit]}),/*#__PURE__*/_jsxs(\"div\",{className:\"awesome-button\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Click below to log today: \"}),/*#__PURE__*/_jsx(TrackerButton,{index:todayIndex,user:this.props.user,handleChange:this.handleChange,challenge:this.props.challenge,challengeDay:this.state.challengeDay})]}),this.state.activeChallengeDetails&&/*#__PURE__*/_jsx(ActiveChallengeDetails,{challenge:this.props.challenge,user:this.props.user,challengeDay:this.state.challengeDay,calculateChallengeDay:this.props.calculateChallengeDay,streakStatus:this.props.streakStatus,notifier:this.notifier}),!this.state.activeChallengeDetails&&/*#__PURE__*/_jsx(\"button\",{className:\"button-light\",onClick:this.toggleChallengeDetails,children:\"show details\"}),this.state.activeChallengeDetails&&/*#__PURE__*/_jsx(\"button\",{className:\"button-light\",onClick:this.toggleChallengeDetails,children:\"hide details\"}),this.state.activeChallengeDetails&&/*#__PURE__*/_jsx(\"button\",{className:\"button-light\",onClick:this.withdrawFromChallenge,children:\"i give up, i'm a bit fat looser\"})]});}}}]);return ActiveChallengePreview;}(Component);export{ActiveChallengePreview as default};","map":{"version":3,"sources":["/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js"],"names":["React","Component","axios","ActiveChallengeDetails","TrackerButton","ActiveChallengePreview","state","challengeDay","activeChallengeDetails","toggleChallengeDetails","setState","prevState","selectReward","rewards","props","user","chosenRewardIndex","Math","floor","random","length","notifier","today","thisProjectsTracker","challenge","tracker","streakStatusData","streakStatus","userID","userId","changedToggle","console","log","currentStreak","subGoals7DayStreak","todaysReward","notifyMilestone","id","notification15Days","subGoals21DayStreak","notification28Days","notificationComplete","daysCompleted","withdrawFromChallenge","put","_id","then","data","setUser","history","push","handleChange","event","target","value","checked","name","challengeTracker","index","challenges","updatedUser","calculateChallengeDay","startDate","todayIndex","title","window","location","reload","goal","dailyTarget","description","number","unit"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './ActiveChallengePreview.css';\n\nexport default class ActiveChallengePreview extends Component {\n  state = {\n    challengeDay: 0,\n    activeChallengeDetails: false,\n  };\n\n  toggleChallengeDetails = () => {\n    this.setState((prevState) => ({\n      activeChallengeDetails: !prevState.activeChallengeDetails,\n    }));\n  };\n\n\n\n  selectReward = () => {\n    const rewards = this.props.user.rewards\n    const chosenRewardIndex = Math.floor(Math.random() * rewards.length)\n    return rewards[chosenRewardIndex];\n  }\n\n  notifier = async() => {\n    const today = this.state.challengeDay;\n    const thisProjectsTracker = this.props.challenge.tracker;\n    const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today);\n    const userID = this.props.userId;\n    let changedToggle = \"\";\n    console.log(`notifier called`);\n    console.log({ today });\n    console.log(`todays val`, thisProjectsTracker[today - 1]);\n\n    console.log({ streakStatusData });\n\n\n\n    //7-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 7\n      && this.props.challenge.subGoals7DayStreak === false\n    ) {\n      changedToggle = \"subGoals7DayStreak\";\n      let todaysReward = this.selectReward();\n      await this.props.notifyMilestone([\"7\", todaysReward, this.props.challenge.id, changedToggle]);\n      console.log(`7 day streak`);\n      this.props.challenge.subGoals7DayStreak = true;\n      return    }\n\n    //half-way\n    if (thisProjectsTracker[today - 1] === 1 &&\n      (today === 15 || today === 16 || today === 17)\n      && this.props.challenge.notification15Days === false\n    ) {\n      console.log(this.props.challenge.notification15Days);\n      changedToggle = \"notification15Days\";\n      await this.props.notifyMilestone([\"15\", {}, this.props.challenge.id, changedToggle]);\n      console.log(`half way`);\n      this.props.challenge.notification15Days = true;\n      console.log(this.props.challenge.notification15Days);\n      return\n    }\n\n    //21-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 21\n      && this.props.challenge.subGoals21DayStreak === false\n    ) {\n      let todaysReward = this.selectReward();\n      changedToggle = \"subGoals21DayStreak\";\n      await this.props.notifyMilestone([\"21\", todaysReward, this.props.challenge.id, changedToggle]);\n      console.log(`21-day streak`);\n      this.props.challenge.subGoals21DayStreak = true;\n      return\n    }\n\n    //nearly there\n    if (thisProjectsTracker[today - 1] === 1 &&\n      today === 28\n      && this.props.challenge.notification28Days === false\n    ) {\n      changedToggle = \"notification28Days\";\n      await this.props.notifyMilestone([\"28\", {}, this.props.challenge.id, changedToggle]);\n      console.log(`nearly there`);\n      this.props.challenge.notification28Days = true;\n      return\n    }\n\n    //completion\n    if (today >= 30\n      && this.props.challenge.notificationComplete === false\n    ) {\n      if (streakStatusData.daysCompleted === 30) {\n        changedToggle = \"notificationCompleted\"\n        await this.props.notifyMilestone([\"success\", {}, this.props.challenge.id, changedToggle]);\n        console.log(`notify complete`);\n        //main goal\n      } else {\n        console.log(`notify near complete`);\n        changedToggle = \"notificationCompleted\"\n        await this.props.notifyMilestone([\"notQuite\", {}, this.props.challenge.id, changedToggle]);\n      }\n      this.props.challenge.notificationComplete = true;\n      return\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay,\n    })\n    console.log(`startdate`, this.props.challenge.startDate);\n\n  }\n\n  withdrawFromChallenge = () => {\n    axios.put(`/users/${this.props.challenge.id._id}/withdraw`)\n      .then((user) => {\n        console.log('user', user.data)\n        this.props.setUser(user.data)\n        console.log('test')\n        this.props.history.push('/')\n      })\n  }\n\n  handleChange = async (event) => {\n    console.log(this.props.user);\n\n    try {\n      const target = event.target;\n      const value = target.checked;\n      const name = target.id;\n      // console.log('target', target, 'value', value, 'name', name);\n      let challengeTracker = this.props.challenge.tracker;\n      let index = target.id;\n      if (event.target.id < this.state.challengeDay) {\n        if (challengeTracker[index] === 0) {\n          challengeTracker[index]++;\n        } else if (challengeTracker[index] === 1) {\n          challengeTracker[index]++;\n        } else {\n          challengeTracker[index]--;\n          challengeTracker[index]--;\n\n        }\n        this.setState({\n          [name]: value,\n        });\n        let userId = this.props.user._id;\n        const updatedUser = await axios.put(`/api/users/${userId}`, {\n          challenges: this.props.user.challenges,\n          rewards: this.props.user.rewards,\n        });\n        this.props.setUser(updatedUser.data);\n        // const refresh = this.props.refreshActiveChallengeDetails()\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  render() {\n    const challengeDay = this.state.challengeDay\n    const todayIndex = challengeDay - 1\n    if (!this.props.challenge.id.title) {\n      window.location.reload(false);\n    } else {\n      // console.log('props from preview ');\n      return (\n        <div className=\"active-preview\">\n          <div className=\"preview-title\">\n            <h5>{this.props.challenge.id.title}</h5>\n          </div>\n          <p>{this.props.challenge.id.goal}</p>\n          <p>\n            {this.props.challenge.id.dailyTarget.description}\n            {this.props.challenge.id.dailyTarget.number}\n            {this.props.challenge.id.dailyTarget.unit}\n          </p>\n\n          <div className=\"awesome-button\">\n            <p>Click below to log today: </p>\n            <TrackerButton\n              index={todayIndex}\n              user={this.props.user}\n              handleChange={this.handleChange}\n              challenge={this.props.challenge}\n              challengeDay={this.state.challengeDay}\n            />\n          </div>\n          {this.state.activeChallengeDetails && (\n            <ActiveChallengeDetails\n              challenge={this.props.challenge}\n              user={this.props.user}\n              challengeDay={this.state.challengeDay}\n              calculateChallengeDay={this.props.calculateChallengeDay}\n              streakStatus={this.props.streakStatus}\n              notifier={this.notifier}\n            />\n          )}\n          {!this.state.activeChallengeDetails && (\n            <button\n              className=\"button-light\"\n              onClick={this.toggleChallengeDetails}\n            >\n              show details\n            </button>\n          )}\n          {this.state.activeChallengeDetails && (\n            <button\n              className=\"button-light\"\n              onClick={this.toggleChallengeDetails}\n            >\n              hide details\n            </button>\n          )}\n          {this.state.activeChallengeDetails &&\n            <button\n              className=\"button-light\"\n              onClick={this.withdrawFromChallenge}\n            >\n              i give up, i'm a bit fat looser\n            </button>\n          }\n        </div>\n      );\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}