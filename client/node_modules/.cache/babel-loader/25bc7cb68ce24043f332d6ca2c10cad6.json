{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _defineProperty from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/markkeeble/Ironhack/course/30-day-streak/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import axios from'axios';import ActiveChallengeDetails from'./ActiveChallengeDetails';import TrackerButton from'./TrackerButton';import'./Dashboard.css';var ActiveChallengePreview=/*#__PURE__*/function(_Component){_inherits(ActiveChallengePreview,_Component);var _super=_createSuper(ActiveChallengePreview);function ActiveChallengePreview(){var _this;_classCallCheck(this,ActiveChallengePreview);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={challengeDay:0,activeChallengeDetails:false,user:''};_this.toggleChallengeDetails=function(){_this.setState(function(prevState){return{activeChallengeDetails:!prevState.activeChallengeDetails};});};_this.selectReward=function(){var rewards=_this.props.user.rewards;var chosenRewardIndex=Math.floor(Math.random()*rewards.length);return rewards[chosenRewardIndex];};_this.notifier=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var today,thisProjectsTracker,streakStatusData,userID,changedToggle,todaysReward,_todaysReward;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:today=_this.state.challengeDay;thisProjectsTracker=_this.props.challenge.tracker;streakStatusData=_this.props.streakStatus(_this.props.challenge.tracker,today);userID=_this.props.userId;changedToggle=\"\";console.log(\"notifier called\");console.log({today:today});console.log(\"todays val\",thisProjectsTracker[today-1]);console.log({streakStatusData:streakStatusData});//7-day streak\nif(!(thisProjectsTracker[today-1]===1&&streakStatusData.currentStreak===7&&_this.props.challenge.subGoals7DayStreak===false)){_context.next=17;break;}changedToggle=\"subGoals7DayStreak\";todaysReward=_this.selectReward();_context.next=14;return _this.props.notifyMilestone([\"7\",todaysReward,_this.props.challenge.id,changedToggle]);case 14:console.log(\"7 day streak\");_this.props.challenge.subGoals7DayStreak=true;return _context.abrupt(\"return\");case 17:if(!(thisProjectsTracker[today-1]===1&&(today===15||today===16||today===17)&&_this.props.challenge.notification15Days===false)){_context.next=26;break;}console.log(_this.props.challenge.notification15Days);changedToggle=\"notification15Days\";_context.next=22;return _this.props.notifyMilestone([\"15\",{},_this.props.challenge.id,changedToggle]);case 22:console.log(\"half way\");_this.props.challenge.notification15Days=true;console.log(_this.props.challenge.notification15Days);return _context.abrupt(\"return\");case 26:if(!(thisProjectsTracker[today-1]===1&&streakStatusData.currentStreak===21&&_this.props.challenge.subGoals21DayStreak===false)){_context.next=34;break;}_todaysReward=_this.selectReward();changedToggle=\"subGoals21DayStreak\";_context.next=31;return _this.props.notifyMilestone([\"21\",_todaysReward,_this.props.challenge.id,changedToggle]);case 31:console.log(\"21-day streak\");_this.props.challenge.subGoals21DayStreak=true;return _context.abrupt(\"return\");case 34:if(!(thisProjectsTracker[today-1]===1&&today===28&&_this.props.challenge.notification28Days===false)){_context.next=41;break;}changedToggle=\"notification28Days\";_context.next=38;return _this.props.notifyMilestone([\"28\",{},_this.props.challenge.id,changedToggle]);case 38:console.log(\"nearly there\");_this.props.challenge.notification28Days=true;return _context.abrupt(\"return\");case 41:if(!(today>=30&&_this.props.challenge.notificationComplete===false)){_context.next=55;break;}if(!(streakStatusData.daysCompleted===30)){_context.next=49;break;}changedToggle=\"notificationCompleted\";_context.next=46;return _this.props.notifyMilestone([\"success\",{},_this.props.challenge.id,changedToggle]);case 46:console.log(\"notify complete\");//main goal\n_context.next=53;break;case 49:console.log(\"notify near complete\");changedToggle=\"notificationCompleted\";_context.next=53;return _this.props.notifyMilestone([\"notQuite\",{},_this.props.challenge.id,changedToggle]);case 53:_this.props.challenge.notificationComplete=true;return _context.abrupt(\"return\");case 55:;case 56:case\"end\":return _context.stop();}}},_callee);}));_this.handleChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var target,value,name,challengeTracker,index,userId,updatedUser;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(_this.props.user);_context2.prev=1;target=event.target;value=target.checked;name=target.id;// console.log('target', target, 'value', value, 'name', name);\nchallengeTracker=_this.props.challenge.tracker;console.log('challenge tracker from one button',challengeTracker);index=target.id;if(!(event.target.id<_this.state.challengeDay)){_context2.next=16;break;}if(challengeTracker[index]===0){challengeTracker[index]++;}else if(challengeTracker[index]===1){challengeTracker[index]++;}else{challengeTracker[index]--;challengeTracker[index]--;}_this.setState(_defineProperty({},name,value));userId=_this.props.user._id;_context2.next=14;return axios.put(\"/api/users/\".concat(userId),{challenges:_this.props.user.challenges,rewards:_this.props.user.rewards});case 14:updatedUser=_context2.sent;_this.props.setUser(updatedUser.data);case 16:_context2.next=21;break;case 18:_context2.prev=18;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);case 21:case\"end\":return _context2.stop();}}},_callee2,null,[[1,18]]);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var challengeDay;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:try{challengeDay=_this.props.calculateChallengeDay(_this.props.challenge.startDate);// console.log({challengeDay});\n// console.log('updated user from mount', updatedUser.data);\n_this.setState({challengeDay:challengeDay,user:_this.props.user});}catch(error){console.log(error);}case 1:case\"end\":return _context3.stop();}}},_callee3);}));return _this;}_createClass(ActiveChallengePreview,[{key:\"componentDidMount\",value:function componentDidMount(){var challengeDay=this.props.calculateChallengeDay(this.props.challenge.startDate);this.setState({challengeDay:challengeDay});console.log(\"startdate\",this.props.challenge.startDate);}// withdrawFromChallenge = async () => {\n//   try {\n//     const updatedUser = await axios.put(`/api/users/${this.props.challenge.id._id}/withdraw`)\n//     this.props.setUser(updatedUser.data)\n//     console.log('updated user data', updatedUser.data);\n//     // console.log(this.);\n//     this.props.history.push('/');\n//   } catch (error) {\n//     console.log(error);\n//   }\n// };\n},{key:\"render\",// componentDidUpdate(prevProps) {\n//   console.log('prev props from active challenge preview', prevProps);\n// }\nvalue:function render(){// console.log('user challenges at render', this.props.user.challenges);\n// console.log('challenge props from render', this.props.challenge)\nvar challengeDay=this.state.challengeDay;var todayIndex=challengeDay-1;// if (!this.props.challenge.id.title) {\n//   window.location.reload(false);\n// } else {\n// console.log('props from preview ');\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"active-preview\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"active-preview-no-button\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"preview-challenge-info\",children:[/*#__PURE__*/_jsx(\"h5\",{children:this.props.challenge.id.title}),/*#__PURE__*/_jsx(\"p\",{children:this.props.challenge.id.goal}),/*#__PURE__*/_jsxs(\"p\",{children:[this.props.challenge.id.dailyTarget.description,this.props.challenge.id.dailyTarget.number,this.props.challenge.id.dailyTarget.unit]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"awesome-button\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Click below to \",/*#__PURE__*/_jsx(\"br\",{}),\" log today:\",' ']}),/*#__PURE__*/_jsx(TrackerButton,{index:todayIndex,user:this.props.user,handleChange:this.handleChange,challenge:this.props.challenge,challengeDay:this.state.challengeDay})]})]}),this.state.activeChallengeDetails&&/*#__PURE__*/_jsx(ActiveChallengeDetails,{challenge:this.props.challenge,user:this.props.user,challengeDay:this.state.challengeDay,calculateChallengeDay:this.props.calculateChallengeDay,streakStatus:this.props.streakStatus,notifier:this.notifier}),!this.state.activeChallengeDetails&&/*#__PURE__*/_jsx(\"button\",{className:\"button-dark\",onClick:this.toggleChallengeDetails,children:\"show details\"}),this.state.activeChallengeDetails&&/*#__PURE__*/_jsx(\"button\",{className:\"button-light\",onClick:this.withdrawFromChallenge,children:\"i give up, i'm a bit fat looser\"}),this.state.activeChallengeDetails&&/*#__PURE__*/_jsx(\"button\",{className:\"button-dark\",onClick:this.toggleChallengeDetails,children:\"hide details\"})]});}}]);return ActiveChallengePreview;}(Component);// }\nexport{ActiveChallengePreview as default};","map":{"version":3,"sources":["/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js"],"names":["React","Component","axios","ActiveChallengeDetails","TrackerButton","ActiveChallengePreview","state","challengeDay","activeChallengeDetails","user","toggleChallengeDetails","setState","prevState","selectReward","rewards","props","chosenRewardIndex","Math","floor","random","length","notifier","today","thisProjectsTracker","challenge","tracker","streakStatusData","streakStatus","userID","userId","changedToggle","console","log","currentStreak","subGoals7DayStreak","todaysReward","notifyMilestone","id","notification15Days","subGoals21DayStreak","notification28Days","notificationComplete","daysCompleted","handleChange","event","target","value","checked","name","challengeTracker","index","_id","put","challenges","updatedUser","setUser","data","componentDidMount","calculateChallengeDay","startDate","error","todayIndex","title","goal","dailyTarget","description","number","unit","withdrawFromChallenge"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './Dashboard.css';\n\nexport default class ActiveChallengePreview extends Component {\n  state = {\n    challengeDay: 0,\n    activeChallengeDetails: false,\n    user: '',\n  };\n\n  toggleChallengeDetails = () => {\n    this.setState((prevState) => ({\n      activeChallengeDetails: !prevState.activeChallengeDetails,\n    }));\n  };\n\n  selectReward = () => {\n    const rewards = this.props.user.rewards;\n    const chosenRewardIndex = Math.floor(Math.random() * rewards.length);\n    return rewards[chosenRewardIndex];\n  };\n\n  notifier = async() => {\n    const today = this.state.challengeDay;\n    const thisProjectsTracker = this.props.challenge.tracker;\n    const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today);\n    const userID = this.props.userId;\n    let changedToggle = \"\";\n    console.log(`notifier called`);\n    console.log({ today });\n    console.log(`todays val`, thisProjectsTracker[today - 1]);\n\n    console.log({ streakStatusData });\n\n\n\n    //7-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 7\n      && this.props.challenge.subGoals7DayStreak === false\n    ) {\n      changedToggle = \"subGoals7DayStreak\";\n      let todaysReward = this.selectReward();\n      await this.props.notifyMilestone([\"7\", todaysReward, this.props.challenge.id, changedToggle]);\n\n      console.log(`7 day streak`);\n      this.props.challenge.subGoals7DayStreak = true;\n      return    }\n\n    //half-way\n    if (thisProjectsTracker[today - 1] === 1 &&\n      (today === 15 || today === 16 || today === 17)\n      && this.props.challenge.notification15Days === false\n    ) {\n      console.log(this.props.challenge.notification15Days);\n      changedToggle = \"notification15Days\";\n      await this.props.notifyMilestone([\"15\", {}, this.props.challenge.id, changedToggle]);\n      console.log(`half way`);\n      this.props.challenge.notification15Days = true;\n      console.log(this.props.challenge.notification15Days);\n      return\n    }\n\n    //21-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 21\n      && this.props.challenge.subGoals21DayStreak === false\n    ) {\n      let todaysReward = this.selectReward();\n      changedToggle = \"subGoals21DayStreak\";\n      await this.props.notifyMilestone([\"21\", todaysReward, this.props.challenge.id, changedToggle]);\n      console.log(`21-day streak`);\n      this.props.challenge.subGoals21DayStreak = true;\n      return\n    }\n\n    //nearly there\n    if (thisProjectsTracker[today - 1] === 1 &&\n      today === 28\n      && this.props.challenge.notification28Days === false\n    ) {\n      changedToggle = \"notification28Days\";\n      await this.props.notifyMilestone([\"28\", {}, this.props.challenge.id, changedToggle]);\n\n      console.log(`nearly there`);\n      this.props.challenge.notification28Days = true;\n      return\n    }\n\n    //completion\n    if (today >= 30\n      && this.props.challenge.notificationComplete === false\n    ) {\n      if (streakStatusData.daysCompleted === 30) {\n\n        changedToggle = \"notificationCompleted\"\n        await this.props.notifyMilestone([\"success\", {}, this.props.challenge.id, changedToggle]);\n        console.log(`notify complete`);\n        //main goal\n      } else {\n        console.log(`notify near complete`);\n        changedToggle = \"notificationCompleted\"\n        await this.props.notifyMilestone([\"notQuite\", {}, this.props.challenge.id, changedToggle]);\n      }\n      this.props.challenge.notificationComplete = true;\n      return\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay,\n    })\n    console.log(`startdate`, this.props.challenge.startDate);\n\n  }\n\n\n  // withdrawFromChallenge = async () => {\n  //   try {\n  //     const updatedUser = await axios.put(`/api/users/${this.props.challenge.id._id}/withdraw`)\n  //     this.props.setUser(updatedUser.data)\n  //     console.log('updated user data', updatedUser.data);\n  //     // console.log(this.);\n  //     this.props.history.push('/');\n  //   } catch (error) {\n  //     console.log(error);\n  //   }\n  // };\n\n\n  handleChange = async (event) => {\n    console.log(this.props.user);\n\n    try {\n      const target = event.target;\n      const value = target.checked;\n      const name = target.id;\n      // console.log('target', target, 'value', value, 'name', name);\n      let challengeTracker = this.props.challenge.tracker;\n      console.log('challenge tracker from one button', challengeTracker);\n      let index = target.id;\n      if (event.target.id < this.state.challengeDay) {\n        if (challengeTracker[index] === 0) {\n          challengeTracker[index]++;\n        } else if (challengeTracker[index] === 1) {\n          challengeTracker[index]++;\n        } else {\n          challengeTracker[index]--;\n          challengeTracker[index]--;\n\n        }\n        this.setState({\n          [name]: value,\n        });\n        let userId = this.props.user._id;\n        const updatedUser = await axios.put(`/api/users/${userId}`, {\n          challenges: this.props.user.challenges,\n          rewards: this.props.user.rewards,\n        });\n\n        this.props.setUser(updatedUser.data);\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n\n  componentDidMount = async () => {\n    try {\n      const challengeDay = this.props.calculateChallengeDay(\n        this.props.challenge.startDate\n      );\n      // console.log({challengeDay});\n      // console.log('updated user from mount', updatedUser.data);\n      this.setState({\n        challengeDay: challengeDay,\n        user: this.props.user,\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  // componentDidUpdate(prevProps) {\n  //   console.log('prev props from active challenge preview', prevProps);\n  // }\n\n\n  render() {\n    // console.log('user challenges at render', this.props.user.challenges);\n    // console.log('challenge props from render', this.props.challenge)\n    const challengeDay = this.state.challengeDay;\n    const todayIndex = challengeDay - 1;\n    // if (!this.props.challenge.id.title) {\n    //   window.location.reload(false);\n    // } else {\n    // console.log('props from preview ');\n    return (\n      <div className=\"active-preview\">\n        <div className=\"active-preview-no-button\">\n          <div className=\"preview-challenge-info\">\n            <h5>{this.props.challenge.id.title}</h5>\n            <p>{this.props.challenge.id.goal}</p>\n            <p>\n              {this.props.challenge.id.dailyTarget.description}\n              {this.props.challenge.id.dailyTarget.number}\n              {this.props.challenge.id.dailyTarget.unit}\n            </p>\n          </div>\n          <div className=\"awesome-button\">\n            <p>\n              Click below to <br /> log today:{' '}\n            </p>\n            <TrackerButton\n              index={todayIndex}\n              user={this.props.user}\n              handleChange={this.handleChange}\n              challenge={this.props.challenge}\n              challengeDay={this.state.challengeDay}\n            />\n          </div>\n\n\n        </div>\n        {this.state.activeChallengeDetails && (\n          <ActiveChallengeDetails\n            challenge={this.props.challenge}\n            user={this.props.user}\n            challengeDay={this.state.challengeDay}\n            calculateChallengeDay={this.props.calculateChallengeDay}\n            streakStatus={this.props.streakStatus}\n            notifier={this.notifier}\n          />\n        )}\n        {!this.state.activeChallengeDetails && (\n          <button className=\"button-dark\" onClick={this.toggleChallengeDetails}>\n            show details\n          </button>\n        )}\n        {this.state.activeChallengeDetails && (\n          <button className=\"button-light\" onClick={this.withdrawFromChallenge}>\n            i give up, i'm a bit fat looser\n          </button>\n        )}\n        {this.state.activeChallengeDetails && (\n          <button className=\"button-dark\" onClick={this.toggleChallengeDetails}>\n            hide details\n          </button>\n        )}\n      </div>\n    );\n  }\n}\n// }\n "]},"metadata":{},"sourceType":"module"}