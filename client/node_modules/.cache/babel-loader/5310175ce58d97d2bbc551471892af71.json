{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './ActiveChallengePreview.css';\nexport default class ActiveChallengePreview extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      challengeDay: 0,\n      activeChallengeDetails: false\n    };\n\n    this.toggleChallengeDetails = () => {\n      this.setState(prevState => ({\n        activeChallengeDetails: !prevState.activeChallengeDetails\n      }));\n    };\n\n    this.selectReward = () => {\n      const rewards = this.props.user.rewards;\n      const chosenRewardIndex = Math.floor(Math.random() * rewards.length);\n      return rewards[chosenRewardIndex];\n    };\n\n    this.notifier = () => {\n      const today = this.state.challengeDay;\n      const thisProjectsTracker = this.props.challenge.tracker;\n      const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today);\n      const userID = this.props.userId; //7-day streak\n\n      if (thisProjectsTracker[today - 1] === 1 && streakStatusData.currentStreak === 7 && this.props.challenge.subGoals7DayStreak === false) {\n        console.log(`7 day streak`);\n        this.props.challenge.subGoals7DayStreak = true;\n        let todaysReward = this.selectReward();\n        this.props.notifyMilestone([\"7\", todaysReward, this.props.challenge.id]); //show notification\n      } //half-way\n\n\n      if (thisProjectsTracker[today - 1] === 1 && today >= (15 || 16 || 17) && this.props.challenge.notification15Days === false) {\n        console.log(`half way`);\n        this.props.challenge.notification15Days = true;\n        this.props.notifyMilestone([\"15\", {}, this.props.challenge.id]); //show a notification\n      } //21-day streak\n\n\n      if (thisProjectsTracker[today - 1] === 1 && streakStatusData.currentStreak === 21 && this.props.challenge.subGoals21DayStreak === false) {\n        console.log(`21-day streak`);\n        this.props.challenge.subGoals21DayStreak = true;\n        let todaysReward = this.selectReward();\n        this.props.notifyMilestone([\"21\", todaysReward, this.props.challenge.id]); //select prize\n        //show notification\n      } //nearly there\n\n\n      if (thisProjectsTracker[today - 1] === 1 && today === 28 && this.props.challenge.notification28Days === false) {\n        console.log(`nearly there`);\n        this.props.challenge.notification15Days = true;\n        this.props.notifyMilestone([28, {}, this.props.challenge.id]); //show notification\n      } //completion\n\n\n      if (today >= 30 && this.props.challenge.notificationComplete === false) {\n        this.props.challenge.notificationComplete = true;\n\n        if (streakStatusData.daysCompleted === 30) {\n          this.props.notifyMilestone([\"success\", {}, this.props.challenge.id]); //main goal\n        } else {\n          this.props.notifyMilestone([\"notQuite\", {}, this.props.challenge.id]);\n        }\n      }\n\n      ;\n    };\n\n    this.withdrawFromChallenge = () => {\n      axios.put(`/users/${this.props.challenge.id._id}/withdraw`).then(user => {\n        console.log('user', user.data);\n        this.props.setUser(user.data);\n        console.log('test');\n        this.props.history.push('/');\n      });\n    };\n\n    this.handleChange = async event => {\n      console.log(this.props.user);\n\n      try {\n        const target = event.target;\n        const value = target.checked;\n        const name = target.id; // console.log('target', target, 'value', value, 'name', name);\n\n        let challengeTracker = this.props.challenge.tracker;\n        let index = target.id;\n\n        if (event.target.id < this.state.challengeDay) {\n          if (challengeTracker[index] === 0) {\n            challengeTracker[index]++;\n          } else if (challengeTracker[index] === 1) {\n            challengeTracker[index]++;\n          } else {\n            challengeTracker[index]--;\n          }\n\n          this.setState({\n            [name]: value\n          });\n          let userId = this.state.props._id;\n          const updatedUser = await axios.put(`/api/users/${userId}`, {\n            challenges: this.state.user.challenges,\n            rewards: this.state.user.rewards\n          });\n          const refresh = this.props.refreshActiveChallengeDetails();\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay\n    });\n    console.log(`startdate`, this.props.challenge.startDate);\n  }\n\n  render() {\n    const challengeDay = this.state.challengeDay;\n    const todayIndex = challengeDay - 1;\n\n    if (!this.props.challenge.id.title) {\n      window.location.reload(false);\n    } else {\n      // console.log('props from preview ');\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"active-preview\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"preview-title\",\n          children: /*#__PURE__*/_jsxDEV(\"h5\", {\n            children: this.props.challenge.id.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: this.props.challenge.id.goal\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [this.props.challenge.id.dailyTarget.description, this.props.challenge.id.dailyTarget.number, this.props.challenge.id.dailyTarget.unit]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"awesome-button\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Click below to log today: \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TrackerButton, {\n            index: todayIndex,\n            user: this.props.user,\n            handleChange: this.handleChange,\n            challenge: this.props.challenge,\n            challengeDay: this.state.challengeDay\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 11\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(ActiveChallengeDetails, {\n          challenge: this.props.challenge,\n          user: this.props.user,\n          challengeDay: this.state.challengeDay,\n          calculateChallengeDay: this.props.calculateChallengeDay,\n          streakStatus: this.props.streakStatus,\n          notifier: this.notifier\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 13\n        }, this), !this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.toggleChallengeDetails,\n          children: \"show details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 13\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.toggleChallengeDetails,\n          children: \"hide details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 13\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.withdrawFromChallenge,\n          children: \"i give up, i'm a bit fat looser\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 9\n      }, this);\n    }\n  }\n\n}","map":{"version":3,"sources":["/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js"],"names":["React","Component","axios","ActiveChallengeDetails","TrackerButton","ActiveChallengePreview","state","challengeDay","activeChallengeDetails","toggleChallengeDetails","setState","prevState","selectReward","rewards","props","user","chosenRewardIndex","Math","floor","random","length","notifier","today","thisProjectsTracker","challenge","tracker","streakStatusData","streakStatus","userID","userId","currentStreak","subGoals7DayStreak","console","log","todaysReward","notifyMilestone","id","notification15Days","subGoals21DayStreak","notification28Days","notificationComplete","daysCompleted","withdrawFromChallenge","put","_id","then","data","setUser","history","push","handleChange","event","target","value","checked","name","challengeTracker","index","updatedUser","challenges","refresh","refreshActiveChallengeDetails","error","componentDidMount","calculateChallengeDay","startDate","render","todayIndex","title","window","location","reload","goal","dailyTarget","description","number","unit"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './ActiveChallengePreview.css';\n\nexport default class ActiveChallengePreview extends Component {\n  state = {\n    challengeDay: 0,\n    activeChallengeDetails: false,\n  };\n\n  toggleChallengeDetails = () => {\n    this.setState((prevState) => ({\n      activeChallengeDetails: !prevState.activeChallengeDetails,\n    }));\n  };\n\n\n\n  selectReward = () => {\n    const rewards = this.props.user.rewards\n    const chosenRewardIndex = Math.floor(Math.random() * rewards.length)\n    return rewards[chosenRewardIndex];\n  }\n\n  notifier = () => {\n    const today = this.state.challengeDay;\n    const thisProjectsTracker = this.props.challenge.tracker;\n    const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today);\n    const userID = this.props.userId;\n\n\n    //7-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 7 &&\n      this.props.challenge.subGoals7DayStreak === false) {\n      console.log(`7 day streak`);\n      this.props.challenge.subGoals7DayStreak = true;\n      let todaysReward = this.selectReward();\n      this.props.notifyMilestone([\"7\", todaysReward, this.props.challenge.id]);\n      //show notification\n    }\n\n    //half-way\n    if (thisProjectsTracker[today - 1] === 1 &&\n      today >= (15 || 16 || 17) &&\n      this.props.challenge.notification15Days === false) {\n      console.log(`half way`);\n      this.props.challenge.notification15Days = true;\n      this.props.notifyMilestone([\"15\", {}, this.props.challenge.id]);\n      //show a notification\n    }\n\n    //21-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 21 &&\n      this.props.challenge.subGoals21DayStreak === false) {\n      console.log(`21-day streak`);\n      this.props.challenge.subGoals21DayStreak = true;\n      let todaysReward = this.selectReward();\n      this.props.notifyMilestone([\"21\", todaysReward, this.props.challenge.id]);\n      //select prize\n      //show notification\n    }\n\n    //nearly there\n    if (thisProjectsTracker[today - 1] === 1 &&\n      today === 28 &&\n      this.props.challenge.notification28Days === false) {\n      console.log(`nearly there`);\n      this.props.challenge.notification15Days = true;\n      this.props.notifyMilestone([28, {}, this.props.challenge.id]);\n      //show notification\n    }\n\n    //completion\n    if (today >= 30 && this.props.challenge.notificationComplete === false) {\n      this.props.challenge.notificationComplete = true;\n      if (streakStatusData.daysCompleted === 30) {\n        this.props.notifyMilestone([\"success\", {}, this.props.challenge.id]);//main goal\n      } else {\n        this.props.notifyMilestone([\"notQuite\", {}, this.props.challenge.id]);\n      }\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay,\n    })\n    console.log(`startdate`, this.props.challenge.startDate);\n    \n  }\n\n  withdrawFromChallenge = () => {\n    axios.put(`/users/${this.props.challenge.id._id}/withdraw`)\n    .then((user) => {\n      console.log('user', user.data)\n      this.props.setUser(user.data)\n      console.log('test')\n      this.props.history.push('/')\n    })\n  }\n\n  handleChange = async (event) => {\n    console.log(this.props.user);\n    \n    try {\n      const target = event.target;\n      const value = target.checked;\n      const name = target.id;\n      // console.log('target', target, 'value', value, 'name', name);\n      let challengeTracker = this.props.challenge.tracker;\n      let index = target.id;\n      if (event.target.id < this.state.challengeDay) {\n        if (challengeTracker[index] === 0) {\n          challengeTracker[index]++;\n        } else if (challengeTracker[index] === 1) {\n          challengeTracker[index]++;\n        } else {\n          challengeTracker[index]--;\n        }\n        this.setState({\n          [name]: value,\n        });\n        let userId = this.state.props._id;\n        const updatedUser = await axios.put(`/api/users/${userId}`, {\n          challenges: this.state.user.challenges,\n          rewards: this.state.user.rewards,\n        });\n        const refresh = this.props.refreshActiveChallengeDetails()\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  render() {\n    const challengeDay = this.state.challengeDay\n    const todayIndex = challengeDay - 1\n    if (!this.props.challenge.id.title) {\n      window.location.reload(false);\n    } else {\n      // console.log('props from preview ');\n      return (\n        <div className=\"active-preview\">\n          <div className=\"preview-title\">\n            <h5>{this.props.challenge.id.title}</h5>\n          </div>\n          <p>{this.props.challenge.id.goal}</p>\n          <p>\n            {this.props.challenge.id.dailyTarget.description}\n            {this.props.challenge.id.dailyTarget.number}\n            {this.props.challenge.id.dailyTarget.unit}\n          </p>\n\n          <div className=\"awesome-button\">\n            <p>Click below to log today: </p>\n            <TrackerButton\n              index={todayIndex}\n              user={this.props.user}\n              handleChange={this.handleChange}\n              challenge={this.props.challenge}\n              challengeDay={this.state.challengeDay}\n            />\n          </div>\n          {this.state.activeChallengeDetails && (\n            <ActiveChallengeDetails\n              challenge={this.props.challenge}\n              user={this.props.user}\n              challengeDay={this.state.challengeDay}\n              calculateChallengeDay={this.props.calculateChallengeDay}\n              streakStatus={this.props.streakStatus}\n              notifier={this.notifier}\n            />\n          )}\n          {!this.state.activeChallengeDetails && (\n            <button\n              className=\"button-light\"\n              onClick={this.toggleChallengeDetails}\n            >\n              show details\n            </button>\n          )}\n          {this.state.activeChallengeDetails && (\n            <button\n              className=\"button-light\"\n              onClick={this.toggleChallengeDetails}\n            >\n              hide details\n            </button>\n          )}\n          {this.state.activeChallengeDetails &&\n            <button\n              className=\"button-light\"\n              onClick={this.withdrawFromChallenge}\n            >\n              i give up, i'm a bit fat looser\n            </button>\n          }\n        </div>\n      );\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}