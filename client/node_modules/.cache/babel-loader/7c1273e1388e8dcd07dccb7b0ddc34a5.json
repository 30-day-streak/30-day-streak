{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './ActiveChallengePreview.css';\nexport default class ActiveChallengePreview extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      challengeDay: 0,\n      activeChallengeDetails: false\n    };\n\n    this.toggleChallengeDetails = () => {\n      this.setState(prevState => ({\n        activeChallengeDetails: !prevState.activeChallengeDetails\n      }));\n    };\n\n    this.selectReward = () => {\n      const rewards = this.props.user.rewards;\n      const chosenRewardIndex = Math.floor(Math.random() * rewards.length);\n      return rewards[chosenRewardIndex];\n    };\n\n    this.notifier = () => {\n      const today = this.state.challengeDay;\n      const thisProjectsTracker = this.props.challenge.tracker;\n      const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today); // console.log({ streakStatusData });\n      // console.log(`thisProjectTracker ${thisProjectsTracker}, today ${today}`);\n      // console.log({ streakStatusData });\n      // console.log(`tracker today`, thisProjectsTracker[today - 1]);\n      // console.log(`current streak`, streakStatusData.currentStreak);\n      // console.log(`this.props.challenge.subGoals7DayStreak`, this.props.challenge.subGoals7DayStreak);\n      //7-day streak\n\n      if (thisProjectsTracker[today - 1] === 1 && streakStatusData.currentStreak === 7 && this.props.challenge.subGoals7DayStreak === false) {\n        console.log(`7 day streak`);\n        this.props.challenge.subGoals7DayStreak = true;\n        let todaysReward = this.selectReward();\n        return [\"7\", todaysReward, this.props.challenge.id]; //show notification\n      } //half-way\n\n\n      if (thisProjectsTracker[today - 1] === 1 && today >= (15 || 16 || 17) && this.props.challenge.notification15Days === false) {\n        console.log(`half way`);\n        this.props.challenge.notification15Days = true;\n        return [\"15\", {}, this.props.challenge.id]; //show a notification\n      } //21-day streak\n\n\n      if (thisProjectsTracker[today - 1] === 1 && streakStatusData.currentStreak === 21 && this.props.challenge.subGoals21DayStreak === false) {\n        console.log(`21-day streak`);\n        this.props.challenge.subGoals21DayStreak = true;\n        let todaysReward = this.selectReward();\n        return [\"21\", todaysReward]; //select prize\n        //show notification\n      } //nearly there\n\n\n      if (thisProjectsTracker[today - 1] === 1 && today === 28 && this.props.challenge.notification28Days === false) {\n        console.log(`nearly there`);\n        this.props.challenge.notification15Days = true;\n        return [28, {}]; //show notification\n      } //completion\n\n\n      if (today >= 30 && this.props.challenge.notificationComplete === false) {\n        this.props.challenge.notificationComplete = true;\n\n        if (streakStatusData.daysCompleted === 30) {\n          return [\"success\", {}]; //main goal\n        } else {\n          return [\"notQuite\", {}];\n        }\n      }\n\n      ;\n    };\n\n    this.withdrawFromChallenge = () => {\n      axios.put(`/users/${this.props.challenge.id._id}/withdraw`).then(user => {\n        console.log('user', user.data);\n        this.props.setUser(user.data);\n        console.log('test');\n        this.props.history.push('/');\n      });\n    };\n\n    this.handleChange = async event => {\n      try {\n        const target = event.target;\n        const value = target.checked;\n        const name = target.id; // console.log('target', target, 'value', value, 'name', name);\n\n        let challengeTracker = this.props.challenge.tracker;\n        let index = target.id;\n\n        if (event.target.id < this.state.challengeDay) {\n          if (challengeTracker[index] === 0) {\n            challengeTracker[index]++;\n          } else if (challengeTracker[index] === 1) {\n            challengeTracker[index]++;\n          } else {\n            challengeTracker[index]--;\n          }\n\n          this.setState({\n            [name]: value\n          });\n          let userId = this.state.user._id;\n          const updatedUser = await axios.put(`/api/users/${userId}`, {\n            challenges: this.state.user.challenges,\n            rewards: this.state.user.rewards\n          });\n          const refresh = this.props.refreshActiveChallengeDetails();\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay\n    });\n    console.log(`startdate`, this.props.challenge.startDate);\n  }\n\n  render() {\n    const challengeDay = this.state.challengeDay;\n    const todayIndex = challengeDay - 1;\n\n    if (!this.props.challenge.id.title) {\n      window.location.reload(false);\n    } else {\n      // console.log('props from preview ');\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"active-preview\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"preview-title\",\n          children: /*#__PURE__*/_jsxDEV(\"h5\", {\n            children: this.props.challenge.id.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: this.props.challenge.id.goal\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [this.props.challenge.id.dailyTarget.description, this.props.challenge.id.dailyTarget.number, this.props.challenge.id.dailyTarget.unit]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"awesome-button\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Click below to log today: \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TrackerButton, {\n            index: todayIndex,\n            user: this.props.user,\n            handleChange: this.handleChange,\n            challenge: this.props.challenge,\n            challengeDay: this.state.challengeDay\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 11\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(ActiveChallengeDetails, {\n          challenge: this.props.challenge,\n          user: this.props.user,\n          challengeDay: this.state.challengeDay,\n          calculateChallengeDay: this.props.calculateChallengeDay,\n          streakStatus: this.props.streakStatus,\n          notifier: this.notifier\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 13\n        }, this), !this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.toggleChallengeDetails,\n          children: \"show details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 13\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.toggleChallengeDetails,\n          children: \"hide details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 13\n        }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-light\",\n          onClick: this.withdrawFromChallenge,\n          children: \"i give up, i'm a bit fat looser\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }, this);\n    }\n  }\n\n}","map":{"version":3,"sources":["/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js"],"names":["React","Component","axios","ActiveChallengeDetails","TrackerButton","ActiveChallengePreview","state","challengeDay","activeChallengeDetails","toggleChallengeDetails","setState","prevState","selectReward","rewards","props","user","chosenRewardIndex","Math","floor","random","length","notifier","today","thisProjectsTracker","challenge","tracker","streakStatusData","streakStatus","currentStreak","subGoals7DayStreak","console","log","todaysReward","id","notification15Days","subGoals21DayStreak","notification28Days","notificationComplete","daysCompleted","withdrawFromChallenge","put","_id","then","data","setUser","history","push","handleChange","event","target","value","checked","name","challengeTracker","index","userId","updatedUser","challenges","refresh","refreshActiveChallengeDetails","error","componentDidMount","calculateChallengeDay","startDate","render","todayIndex","title","window","location","reload","goal","dailyTarget","description","number","unit"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './ActiveChallengePreview.css';\n\nexport default class ActiveChallengePreview extends Component {\n  state = {\n    challengeDay: 0,\n    activeChallengeDetails: false,\n  };\n\n  toggleChallengeDetails = () => {\n    this.setState((prevState) => ({\n      activeChallengeDetails: !prevState.activeChallengeDetails,\n    }));\n  };\n\n\n\n  selectReward = () => {\n    const rewards = this.props.user.rewards\n    const chosenRewardIndex = Math.floor(Math.random() * rewards.length)\n    return rewards[chosenRewardIndex];\n  }\n\n  notifier = () => {\n    const today = this.state.challengeDay\n    const thisProjectsTracker = this.props.challenge.tracker\n    const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today)\n    // console.log({ streakStatusData });\n\n    // console.log(`thisProjectTracker ${thisProjectsTracker}, today ${today}`);\n    // console.log({ streakStatusData });\n    // console.log(`tracker today`, thisProjectsTracker[today - 1]);\n    // console.log(`current streak`, streakStatusData.currentStreak);\n    // console.log(`this.props.challenge.subGoals7DayStreak`, this.props.challenge.subGoals7DayStreak);\n\n    //7-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 7 &&\n      this.props.challenge.subGoals7DayStreak === false) {\n      console.log(`7 day streak`);\n      this.props.challenge.subGoals7DayStreak = true;\n      let todaysReward = this.selectReward();\n      return [\"7\", todaysReward, this.props.challenge.id];\n      //show notification\n    }\n\n    //half-way\n    if (thisProjectsTracker[today - 1] === 1 &&\n      today >= (15 || 16 || 17) &&\n      this.props.challenge.notification15Days === false) {\n      console.log(`half way`);\n      this.props.challenge.notification15Days = true;\n      return [\"15\", {}, this.props.challenge.id];\n      //show a notification\n    }\n\n    //21-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 21 &&\n      this.props.challenge.subGoals21DayStreak === false) {\n      console.log(`21-day streak`);\n      this.props.challenge.subGoals21DayStreak = true;\n      let todaysReward = this.selectReward();\n      return [\"21\", todaysReward];\n      //select prize\n      //show notification\n    }\n\n    //nearly there\n    if (thisProjectsTracker[today - 1] === 1 &&\n      today === 28 &&\n      this.props.challenge.notification28Days === false) {\n      console.log(`nearly there`);\n      this.props.challenge.notification15Days = true;\n      return [28, {}];\n      //show notification\n    }\n\n    //completion\n    if (today >= 30 && this.props.challenge.notificationComplete === false) {\n      this.props.challenge.notificationComplete = true;\n      if (streakStatusData.daysCompleted === 30) {\n        return [\"success\", {}];//main goal\n      } else {\n        return [\"notQuite\", {}];\n      }\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay,\n    })\n    console.log(`startdate`, this.props.challenge.startDate);\n    \n  }\n\n  withdrawFromChallenge = () => {\n    axios.put(`/users/${this.props.challenge.id._id}/withdraw`)\n    .then((user) => {\n      console.log('user', user.data)\n      this.props.setUser(user.data)\n      console.log('test')\n      this.props.history.push('/')\n    })\n  }\n\n  handleChange = async (event) => {\n    try {\n      const target = event.target;\n      const value = target.checked;\n      const name = target.id;\n      // console.log('target', target, 'value', value, 'name', name);\n      let challengeTracker = this.props.challenge.tracker;\n      let index = target.id;\n      if (event.target.id < this.state.challengeDay) {\n        if (challengeTracker[index] === 0) {\n          challengeTracker[index]++;\n        } else if (challengeTracker[index] === 1) {\n          challengeTracker[index]++;\n        } else {\n          challengeTracker[index]--;\n        }\n        this.setState({\n          [name]: value,\n        });\n        let userId = this.state.user._id;\n        const updatedUser = await axios.put(`/api/users/${userId}`, {\n          challenges: this.state.user.challenges,\n          rewards: this.state.user.rewards,\n        });\n        const refresh = this.props.refreshActiveChallengeDetails()\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  render() {\n    const challengeDay = this.state.challengeDay\n    const todayIndex = challengeDay - 1\n    if (!this.props.challenge.id.title) {\n      window.location.reload(false);\n    } else {\n      // console.log('props from preview ');\n      return (\n        <div className=\"active-preview\">\n          <div className=\"preview-title\">\n            <h5>{this.props.challenge.id.title}</h5>\n          </div>\n          <p>{this.props.challenge.id.goal}</p>\n          <p>\n            {this.props.challenge.id.dailyTarget.description}\n            {this.props.challenge.id.dailyTarget.number}\n            {this.props.challenge.id.dailyTarget.unit}\n          </p>\n\n          <div className=\"awesome-button\">\n            <p>Click below to log today: </p>\n            <TrackerButton\n              index={todayIndex}\n              user={this.props.user}\n              handleChange={this.handleChange}\n              challenge={this.props.challenge}\n              challengeDay={this.state.challengeDay}\n            />\n          </div>\n          {this.state.activeChallengeDetails && (\n            <ActiveChallengeDetails\n              challenge={this.props.challenge}\n              user={this.props.user}\n              challengeDay={this.state.challengeDay}\n              calculateChallengeDay={this.props.calculateChallengeDay}\n              streakStatus={this.props.streakStatus}\n              notifier={this.notifier}\n            />\n          )}\n          {!this.state.activeChallengeDetails && (\n            <button\n              className=\"button-light\"\n              onClick={this.toggleChallengeDetails}\n            >\n              show details\n            </button>\n          )}\n          {this.state.activeChallengeDetails && (\n            <button\n              className=\"button-light\"\n              onClick={this.toggleChallengeDetails}\n            >\n              hide details\n            </button>\n          )}\n          {this.state.activeChallengeDetails &&\n            <button\n              className=\"button-light\"\n              onClick={this.withdrawFromChallenge}\n            >\n              i give up, i'm a bit fat looser\n            </button>\n          }\n        </div>\n      );\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}