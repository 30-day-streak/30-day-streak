{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './Dashboard.css';\nexport default class ActiveChallengePreview extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      challengeDay: 0,\n      activeChallengeDetails: false,\n      user: ''\n    };\n\n    this.toggleChallengeDetails = () => {\n      this.setState(prevState => ({\n        activeChallengeDetails: !prevState.activeChallengeDetails\n      }));\n    };\n\n    this.selectReward = () => {\n      const rewards = this.props.user.rewards;\n      const chosenRewardIndex = Math.floor(Math.random() * rewards.length);\n      return rewards[chosenRewardIndex];\n    };\n\n    this.notifier = async () => {\n      const today = this.state.challengeDay;\n      const thisProjectsTracker = this.props.challenge.tracker;\n      const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today);\n      const userID = this.props.userId;\n      let changedToggle = \"\";\n      console.log(`notifier called`);\n      console.log({\n        today\n      });\n      console.log(`todays val`, thisProjectsTracker[today - 1]);\n      console.log({\n        streakStatusData\n      }); //7-day streak\n\n      if (thisProjectsTracker[today - 1] === 1 && streakStatusData.currentStreak === 7 && this.props.challenge.subGoals7DayStreak === false) {\n        changedToggle = \"subGoals7DayStreak\";\n        let todaysReward = this.selectReward();\n        await this.props.notifyMilestone([\"7\", todaysReward, this.props.challenge.id, changedToggle]);\n        console.log(`7 day streak`);\n        this.props.challenge.subGoals7DayStreak = true;\n        return;\n      } //half-way\n\n\n      if (thisProjectsTracker[today - 1] === 1 && (today === 15 || today === 16 || today === 17) && this.props.challenge.notification15Days === false) {\n        console.log(this.props.challenge.notification15Days);\n        changedToggle = \"notification15Days\";\n        await this.props.notifyMilestone([\"15\", {}, this.props.challenge.id, changedToggle]);\n        console.log(`half way`);\n        this.props.challenge.notification15Days = true;\n        console.log(this.props.challenge.notification15Days);\n        return;\n      } //21-day streak\n\n\n      if (thisProjectsTracker[today - 1] === 1 && streakStatusData.currentStreak === 21 && this.props.challenge.subGoals21DayStreak === false) {\n        let todaysReward = this.selectReward();\n        changedToggle = \"subGoals21DayStreak\";\n        await this.props.notifyMilestone([\"21\", todaysReward, this.props.challenge.id, changedToggle]);\n        console.log(`21-day streak`);\n        this.props.challenge.subGoals21DayStreak = true;\n        return;\n      } //nearly there\n\n\n      if (thisProjectsTracker[today - 1] === 1 && today === 28 && this.props.challenge.notification28Days === false) {\n        changedToggle = \"notification28Days\";\n        await this.props.notifyMilestone([\"28\", {}, this.props.challenge.id, changedToggle]);\n        console.log(`nearly there`);\n        this.props.challenge.notification28Days = true;\n        return;\n      } //completion\n\n\n      if (today >= 30 && this.props.challenge.notificationComplete === false) {\n        if (streakStatusData.daysCompleted === 30) {\n          changedToggle = \"notificationCompleted\";\n          await this.props.notifyMilestone([\"success\", {}, this.props.challenge.id, changedToggle]);\n          console.log(`notify complete`); //main goal\n        } else {\n          console.log(`notify near complete`);\n          changedToggle = \"notificationCompleted\";\n          await this.props.notifyMilestone([\"notQuite\", {}, this.props.challenge.id, changedToggle]);\n        }\n\n        this.props.challenge.notificationComplete = true;\n        return;\n      }\n\n      ;\n    };\n\n    this.handleChange = async event => {\n      console.log(this.props.user);\n\n      try {\n        const target = event.target;\n        const value = target.checked;\n        const name = target.id; // console.log('target', target, 'value', value, 'name', name);\n\n        let challengeTracker = this.props.challenge.tracker;\n        console.log('challenge tracker from one button', challengeTracker);\n        let index = target.id;\n\n        if (event.target.id < this.state.challengeDay) {\n          if (challengeTracker[index] === 0) {\n            challengeTracker[index]++;\n          } else if (challengeTracker[index] === 1) {\n            challengeTracker[index]++;\n          } else {\n            challengeTracker[index]--;\n            challengeTracker[index]--;\n          }\n\n          this.setState({\n            [name]: value\n          });\n          let userId = this.props.user._id;\n          const updatedUser = await axios.put(`/api/users/${userId}`, {\n            challenges: this.props.user.challenges,\n            rewards: this.props.user.rewards\n          });\n          this.props.setUser(updatedUser.data);\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    this.componentDidMount = async () => {\n      try {\n        const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate); // console.log({challengeDay});\n        // console.log('updated user from mount', updatedUser.data);\n\n        this.setState({\n          challengeDay: challengeDay,\n          user: this.props.user\n        });\n      } catch (error) {\n        console.log(error);\n      }\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay\n    });\n    console.log(`startdate`, this.props.challenge.startDate);\n  } // withdrawFromChallenge = async () => {\n  //   try {\n  //     const updatedUser = await axios.put(`/api/users/${this.props.challenge.id._id}/withdraw`)\n  //     this.props.setUser(updatedUser.data)\n  //     console.log('updated user data', updatedUser.data);\n  //     // console.log(this.);\n  //     this.props.history.push('/');\n  //   } catch (error) {\n  //     console.log(error);\n  //   }\n  // };\n\n\n  // componentDidUpdate(prevProps) {\n  //   console.log('prev props from active challenge preview', prevProps);\n  // }\n  render() {\n    // console.log('user challenges at render', this.props.user.challenges);\n    // console.log('challenge props from render', this.props.challenge)\n    const challengeDay = this.state.challengeDay;\n    const todayIndex = challengeDay - 1; // if (!this.props.challenge.id.title) {\n    //   window.location.reload(false);\n    // } else {\n    // console.log('props from preview ');\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"active-preview\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"active-preview-no-button\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"preview-challenge-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n            children: this.props.challenge.id.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: this.props.challenge.id.goal\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [this.props.challenge.id.dailyTarget.description, this.props.challenge.id.dailyTarget.number, this.props.challenge.id.dailyTarget.unit]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"awesome-button\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"Click below to \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 218,\n              columnNumber: 30\n            }, this), \" log today:\", ' ']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TrackerButton, {\n            index: todayIndex,\n            user: this.props.user,\n            handleChange: this.handleChange,\n            challenge: this.props.challenge,\n            challengeDay: this.state.challengeDay\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 9\n      }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(ActiveChallengeDetails, {\n        challenge: this.props.challenge,\n        user: this.props.user,\n        challengeDay: this.state.challengeDay,\n        calculateChallengeDay: this.props.calculateChallengeDay,\n        streakStatus: this.props.streakStatus,\n        notifier: this.notifier\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 11\n      }, this), !this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button-dark\",\n        onClick: this.toggleChallengeDetails,\n        children: \"show details\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 11\n      }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button-light\",\n        onClick: this.withdrawFromChallenge,\n        children: \"i give up, i'm a bit fat looser\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 11\n      }, this), this.state.activeChallengeDetails && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button-dark\",\n        onClick: this.toggleChallengeDetails,\n        children: \"hide details\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 7\n    }, this);\n  }\n\n} // }","map":{"version":3,"sources":["/Users/markkeeble/Ironhack/course/30-day-streak/client/src/components/dashboard/ActiveChallengePreview.js"],"names":["React","Component","axios","ActiveChallengeDetails","TrackerButton","ActiveChallengePreview","state","challengeDay","activeChallengeDetails","user","toggleChallengeDetails","setState","prevState","selectReward","rewards","props","chosenRewardIndex","Math","floor","random","length","notifier","today","thisProjectsTracker","challenge","tracker","streakStatusData","streakStatus","userID","userId","changedToggle","console","log","currentStreak","subGoals7DayStreak","todaysReward","notifyMilestone","id","notification15Days","subGoals21DayStreak","notification28Days","notificationComplete","daysCompleted","handleChange","event","target","value","checked","name","challengeTracker","index","_id","updatedUser","put","challenges","setUser","data","error","componentDidMount","calculateChallengeDay","startDate","render","todayIndex","title","goal","dailyTarget","description","number","unit","withdrawFromChallenge"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport ActiveChallengeDetails from './ActiveChallengeDetails';\nimport TrackerButton from './TrackerButton';\nimport './Dashboard.css';\n\nexport default class ActiveChallengePreview extends Component {\n  state = {\n    challengeDay: 0,\n    activeChallengeDetails: false,\n    user: '',\n  };\n\n  toggleChallengeDetails = () => {\n    this.setState((prevState) => ({\n      activeChallengeDetails: !prevState.activeChallengeDetails,\n    }));\n  };\n\n  selectReward = () => {\n    const rewards = this.props.user.rewards;\n    const chosenRewardIndex = Math.floor(Math.random() * rewards.length);\n    return rewards[chosenRewardIndex];\n  };\n\n  notifier = async() => {\n    const today = this.state.challengeDay;\n    const thisProjectsTracker = this.props.challenge.tracker;\n    const streakStatusData = this.props.streakStatus(this.props.challenge.tracker, today);\n    const userID = this.props.userId;\n    let changedToggle = \"\";\n    console.log(`notifier called`);\n    console.log({ today });\n    console.log(`todays val`, thisProjectsTracker[today - 1]);\n\n    console.log({ streakStatusData });\n\n\n\n    //7-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 7\n      && this.props.challenge.subGoals7DayStreak === false\n    ) {\n      changedToggle = \"subGoals7DayStreak\";\n      let todaysReward = this.selectReward();\n      await this.props.notifyMilestone([\"7\", todaysReward, this.props.challenge.id, changedToggle]);\n\n      console.log(`7 day streak`);\n      this.props.challenge.subGoals7DayStreak = true;\n      return    }\n\n    //half-way\n    if (thisProjectsTracker[today - 1] === 1 &&\n      (today === 15 || today === 16 || today === 17)\n      && this.props.challenge.notification15Days === false\n    ) {\n      console.log(this.props.challenge.notification15Days);\n      changedToggle = \"notification15Days\";\n      await this.props.notifyMilestone([\"15\", {}, this.props.challenge.id, changedToggle]);\n      console.log(`half way`);\n      this.props.challenge.notification15Days = true;\n      console.log(this.props.challenge.notification15Days);\n      return\n    }\n\n    //21-day streak\n    if (thisProjectsTracker[today - 1] === 1 &&\n      streakStatusData.currentStreak === 21\n      && this.props.challenge.subGoals21DayStreak === false\n    ) {\n      let todaysReward = this.selectReward();\n      changedToggle = \"subGoals21DayStreak\";\n      await this.props.notifyMilestone([\"21\", todaysReward, this.props.challenge.id, changedToggle]);\n      console.log(`21-day streak`);\n      this.props.challenge.subGoals21DayStreak = true;\n      return\n    }\n\n    //nearly there\n    if (thisProjectsTracker[today - 1] === 1 &&\n      today === 28\n      && this.props.challenge.notification28Days === false\n    ) {\n      changedToggle = \"notification28Days\";\n      await this.props.notifyMilestone([\"28\", {}, this.props.challenge.id, changedToggle]);\n\n      console.log(`nearly there`);\n      this.props.challenge.notification28Days = true;\n      return\n    }\n\n    //completion\n    if (today >= 30\n      && this.props.challenge.notificationComplete === false\n    ) {\n      if (streakStatusData.daysCompleted === 30) {\n\n        changedToggle = \"notificationCompleted\"\n        await this.props.notifyMilestone([\"success\", {}, this.props.challenge.id, changedToggle]);\n        console.log(`notify complete`);\n        //main goal\n      } else {\n        console.log(`notify near complete`);\n        changedToggle = \"notificationCompleted\"\n        await this.props.notifyMilestone([\"notQuite\", {}, this.props.challenge.id, changedToggle]);\n      }\n      this.props.challenge.notificationComplete = true;\n      return\n    };\n  }\n\n  componentDidMount() {\n    const challengeDay = this.props.calculateChallengeDay(this.props.challenge.startDate);\n    this.setState({\n      challengeDay: challengeDay,\n    })\n    console.log(`startdate`, this.props.challenge.startDate);\n\n  }\n\n\n  // withdrawFromChallenge = async () => {\n  //   try {\n  //     const updatedUser = await axios.put(`/api/users/${this.props.challenge.id._id}/withdraw`)\n  //     this.props.setUser(updatedUser.data)\n  //     console.log('updated user data', updatedUser.data);\n  //     // console.log(this.);\n  //     this.props.history.push('/');\n  //   } catch (error) {\n  //     console.log(error);\n  //   }\n  // };\n\n\n  handleChange = async (event) => {\n    console.log(this.props.user);\n\n    try {\n      const target = event.target;\n      const value = target.checked;\n      const name = target.id;\n      // console.log('target', target, 'value', value, 'name', name);\n      let challengeTracker = this.props.challenge.tracker;\n      console.log('challenge tracker from one button', challengeTracker);\n      let index = target.id;\n      if (event.target.id < this.state.challengeDay) {\n        if (challengeTracker[index] === 0) {\n          challengeTracker[index]++;\n        } else if (challengeTracker[index] === 1) {\n          challengeTracker[index]++;\n        } else {\n          challengeTracker[index]--;\n          challengeTracker[index]--;\n\n        }\n        this.setState({\n          [name]: value,\n        });\n        let userId = this.props.user._id;\n        const updatedUser = await axios.put(`/api/users/${userId}`, {\n          challenges: this.props.user.challenges,\n          rewards: this.props.user.rewards,\n        });\n\n        this.props.setUser(updatedUser.data);\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n\n  componentDidMount = async () => {\n    try {\n      const challengeDay = this.props.calculateChallengeDay(\n        this.props.challenge.startDate\n      );\n      // console.log({challengeDay});\n      // console.log('updated user from mount', updatedUser.data);\n      this.setState({\n        challengeDay: challengeDay,\n        user: this.props.user,\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  // componentDidUpdate(prevProps) {\n  //   console.log('prev props from active challenge preview', prevProps);\n  // }\n\n\n  render() {\n    // console.log('user challenges at render', this.props.user.challenges);\n    // console.log('challenge props from render', this.props.challenge)\n    const challengeDay = this.state.challengeDay;\n    const todayIndex = challengeDay - 1;\n    // if (!this.props.challenge.id.title) {\n    //   window.location.reload(false);\n    // } else {\n    // console.log('props from preview ');\n    return (\n      <div className=\"active-preview\">\n        <div className=\"active-preview-no-button\">\n          <div className=\"preview-challenge-info\">\n            <h5>{this.props.challenge.id.title}</h5>\n            <p>{this.props.challenge.id.goal}</p>\n            <p>\n              {this.props.challenge.id.dailyTarget.description}\n              {this.props.challenge.id.dailyTarget.number}\n              {this.props.challenge.id.dailyTarget.unit}\n            </p>\n          </div>\n          <div className=\"awesome-button\">\n            <p>\n              Click below to <br /> log today:{' '}\n            </p>\n            <TrackerButton\n              index={todayIndex}\n              user={this.props.user}\n              handleChange={this.handleChange}\n              challenge={this.props.challenge}\n              challengeDay={this.state.challengeDay}\n            />\n          </div>\n\n\n        </div>\n        {this.state.activeChallengeDetails && (\n          <ActiveChallengeDetails\n            challenge={this.props.challenge}\n            user={this.props.user}\n            challengeDay={this.state.challengeDay}\n            calculateChallengeDay={this.props.calculateChallengeDay}\n            streakStatus={this.props.streakStatus}\n            notifier={this.notifier}\n          />\n        )}\n        {!this.state.activeChallengeDetails && (\n          <button className=\"button-dark\" onClick={this.toggleChallengeDetails}>\n            show details\n          </button>\n        )}\n        {this.state.activeChallengeDetails && (\n          <button className=\"button-light\" onClick={this.withdrawFromChallenge}>\n            i give up, i'm a bit fat looser\n          </button>\n        )}\n        {this.state.activeChallengeDetails && (\n          <button className=\"button-dark\" onClick={this.toggleChallengeDetails}>\n            hide details\n          </button>\n        )}\n      </div>\n    );\n  }\n}\n// }\n "]},"metadata":{},"sourceType":"module"}